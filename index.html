
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Command line interface to the LanceOTron peak caller">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.3">
    
    
      
        <title>LanceOTron</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.f7f47774.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lanceotron-command-line-interface" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="LanceOTron" class="md-header__button md-logo" aria-label="LanceOTron" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LanceOTron
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Overview
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/chris1221/lanceotron/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Chris1221/lanceotron
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="LanceOTron" class="md-nav__button md-logo" aria-label="LanceOTron" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LanceOTron
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/chris1221/lanceotron/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Chris1221/lanceotron
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        Overview
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#call-peaks" class="md-nav__link">
    Call Peaks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lanceotron.modules.find_and_score_peaks" class="md-nav__link">
    lanceotron.modules.find_and_score_peaks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#call-peaks-with-input" class="md-nav__link">
    Call Peaks with Input
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lanceotron.modules.call_peaks_with_input" class="md-nav__link">
    lanceotron.modules.call_peaks_with_input
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#score-a-bed-file" class="md-nav__link">
    Score a Bed file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lanceotron.modules.score_bed" class="md-nav__link">
    lanceotron.modules.score_bed
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#citation" class="md-nav__link">
    Citation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bug-reports-and-improvement-suggestions" class="md-nav__link">
    Bug Reports and Improvement Suggestions
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Tutorials
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="genome_tutorial/" class="md-nav__link">
        Basic Peak Calling
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="api/modules/" class="md-nav__link">
        API Documentation
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#call-peaks" class="md-nav__link">
    Call Peaks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lanceotron.modules.find_and_score_peaks" class="md-nav__link">
    lanceotron.modules.find_and_score_peaks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#call-peaks-with-input" class="md-nav__link">
    Call Peaks with Input
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lanceotron.modules.call_peaks_with_input" class="md-nav__link">
    lanceotron.modules.call_peaks_with_input
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#score-a-bed-file" class="md-nav__link">
    Score a Bed file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lanceotron.modules.score_bed" class="md-nav__link">
    lanceotron.modules.score_bed
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#citation" class="md-nav__link">
    Citation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bug-reports-and-improvement-suggestions" class="md-nav__link">
    Bug Reports and Improvement Suggestions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/chris1221/lanceotron/edit/master/docs/index.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="lanceotron-command-line-interface">LanceOTron Command Line Interface</h1>
<p><a href="https://circleci.com/gh/Chris1221/lanceotron/tree/main"><img alt="CircleCI" src="https://circleci.com/gh/Chris1221/lanceotron/tree/main.svg?style=svg&amp;circle-token=bf3f78a54437e63368f5b9dc1c536d7f32f32393" /></a></p>
<p>A bare-bones interface to the trained LanceOTron (LoT) model from the command line. </p>
<p>LoT is an all-in-one peak caller that identifies peak regions from a coverage track and uses a convolutional neural network to classify them based on their shape. This algorithm has a web client available at https://lanceotron.molbiol.ox.ac.uk/ where users can upload coverage tracks, call peaks, and visualize them using <a href="https://lanceotron.readthedocs.io/en/latest/multi_locus_view/multi_locus_view.html">multi locus view</a>, a powerful visualization engine. This web client will do most of the heavy lifting for most of the people that want to use the tool, but for those who need to call peaks in batch mode we provide a command line interface in this package. This document details the installation of LoT as well as typical use cases. See the left side of this page for tutorials on the three main modules. </p>
<h2 id="installation">Installation</h2>
<ol>
<li>Clone the repository.</li>
<li>Install dependencies with pip.</li>
<li>Install the package.</li>
<li>Run tests to ensure that everything is working.</li>
</ol>
<pre><code>git clone git@github.com:Chris1221/lanceotron.git; cd lanceotron # Step 1
pip install -r requirements.txt # Step 2
pip install -e . # Step 3
python -m unittest
</code></pre>
<h2 id="usage">Usage</h2>
<p>To see available commands, use the <code>--help</code> flag.</p>
<pre><code>lanceotron --help
</code></pre>
<h2 id="call-peaks">Call Peaks</h2>
<p>To call peaks from a bigWig track, use the <code>callPeaks</code> command.</p>


  <div class="doc doc-object doc-function">

<a id="lanceotron.modules.find_and_score_peaks"></a>
    <div class="doc doc-contents first">

      <p>Call peaks from a coverage track and score them using the LanceOTron model.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>file</code></td>
        <td><code>str</code></td>
        <td><p>Path to bigwig track.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>threshold</code></td>
        <td><code>int</code></td>
        <td><p>Initial threshold used for selecting candidate peaks. Defaults to 4.</p></td>
        <td><code>4</code></td>
      </tr>
      <tr>
        <td><code>window</code></td>
        <td><code>int</code></td>
        <td><p>Window size for rolling mean to use for selecting candidate peaks. Defaults to 400.</p></td>
        <td><code>400</code></td>
      </tr>
      <tr>
        <td><code>folder</code></td>
        <td><code>str</code></td>
        <td><p>Output folder. Defaults to "./".</p></td>
        <td><code>&#39;./&#39;</code></td>
      </tr>
      <tr>
        <td><code>skipheader</code></td>
        <td><code>bool</code></td>
        <td><p>Skip writing header. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>lanceotron/modules.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">find_and_score_peaks</span><span class="p">(</span>
        <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
        <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
        <span class="n">window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> 
        <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span> 
        <span class="n">skipheader</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Call peaks from a coverage track and score them using the LanceOTron model.</span>

<span class="sd">    Args:</span>
<span class="sd">        file (str): Path to bigwig track.</span>
<span class="sd">        threshold (int, optional): Initial threshold used for selecting candidate peaks. Defaults to 4.</span>
<span class="sd">        window (int, optional): Window size for rolling mean to use for selecting candidate peaks. Defaults to 400.</span>
<span class="sd">        folder (str, optional): Output folder. Defaults to &quot;./&quot;.</span>
<span class="sd">        skipheader (bool, optional): Skip writing header. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">bigwig_file</span> <span class="o">=</span> <span class="n">file</span>
    <span class="n">out_folder</span> <span class="o">=</span> <span class="n">make_directory_name</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="n">initial_threshold</span> <span class="o">=</span> <span class="n">threshold</span>

    <span class="n">min_peak_width</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">max_peak_width</span> <span class="o">=</span> <span class="mi">2000</span>
    <span class="n">read_coverage_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">9</span>
    <span class="n">out_file_name</span> <span class="o">=</span> <span class="n">bigwig_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_L-tron.bed&#39;</span>

    <span class="n">pyBigWig_object</span> <span class="o">=</span> <span class="n">pyBigWig</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">bigwig_file</span><span class="p">)</span>
    <span class="n">read_coverage_total</span> <span class="o">=</span> <span class="n">pyBigWig_object</span><span class="o">.</span><span class="n">header</span><span class="p">()[</span><span class="s1">&#39;sumData&#39;</span><span class="p">]</span>
    <span class="n">read_coverage_rphm</span> <span class="o">=</span> <span class="n">read_coverage_total</span><span class="o">/</span><span class="n">read_coverage_factor</span>
    <span class="n">pyBigWig_object</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">bigwig_data</span> <span class="o">=</span> <span class="n">Ltron</span><span class="o">.</span><span class="n">Bigwig_data</span><span class="p">(</span><span class="n">bigwig_file</span><span class="p">)</span>
    <span class="n">genome_stats_dict</span> <span class="o">=</span> <span class="n">bigwig_data</span><span class="o">.</span><span class="n">get_genome_info</span><span class="p">()</span>
    <span class="n">bed_file_out</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">chrom</span> <span class="ow">in</span> <span class="n">genome_stats_dict</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">chrom</span><span class="p">)</span>
        <span class="n">coverage_array_smooth</span> <span class="o">=</span> <span class="n">bigwig_data</span><span class="o">.</span><span class="n">make_chrom_coverage_map</span><span class="p">(</span><span class="n">genome_stats_dict</span><span class="p">[</span><span class="n">chrom</span><span class="p">],</span> <span class="n">smoothing</span><span class="o">=</span><span class="n">window</span><span class="p">)</span>
        <span class="n">enriched_region_coord_list</span> <span class="o">=</span> <span class="n">Ltron</span><span class="o">.</span><span class="n">label_enriched_regions_dynamic_threshold_width</span><span class="p">(</span><span class="n">coverage_array_smooth</span><span class="p">,</span> <span class="n">genome_stats_dict</span><span class="p">[</span><span class="n">chrom</span><span class="p">][</span><span class="s1">&#39;chrom_mean&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">initial_threshold</span><span class="p">,</span> <span class="n">genome_stats_dict</span><span class="p">[</span><span class="n">chrom</span><span class="p">][</span><span class="s1">&#39;chrom_mean&#39;</span><span class="p">],</span> <span class="n">max_peak_width</span><span class="p">,</span> <span class="n">min_region_size</span><span class="o">=</span><span class="n">min_peak_width</span><span class="p">)</span>
        <span class="n">chrom_file_out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">enriched_region_coord_list</span><span class="p">:</span>
            <span class="n">wide_path</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s1">&#39;lanceotron.static&#39;</span><span class="p">,</span> <span class="s1">&#39;standard_scaler_wide_v5_03.p&#39;</span><span class="p">)</span>
            <span class="n">deep_path</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s1">&#39;lanceotron.static&#39;</span><span class="p">,</span> <span class="s1">&#39;standard_scaler_deep_v5_03.p&#39;</span><span class="p">)</span>

            <span class="n">coverage_array</span> <span class="o">=</span> <span class="n">bigwig_data</span><span class="o">.</span><span class="n">make_chrom_coverage_map</span><span class="p">(</span><span class="n">genome_stats_dict</span><span class="p">[</span><span class="n">chrom</span><span class="p">])</span><span class="o">/</span><span class="n">read_coverage_rphm</span>
            <span class="n">X_wide_array</span><span class="p">,</span> <span class="n">X_deep_array</span> <span class="o">=</span> <span class="n">Ltron</span><span class="o">.</span><span class="n">extract_signal_wide_and_deep_chrom</span><span class="p">(</span><span class="n">coverage_array</span><span class="p">,</span> <span class="n">enriched_region_coord_list</span><span class="p">,</span> <span class="n">read_coverage_rphm</span><span class="p">)</span>
            <span class="n">standard_scaler_wide</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">wide_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
            <span class="n">X_wide_array_norm</span> <span class="o">=</span> <span class="n">standard_scaler_wide</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_wide_array</span><span class="p">)</span>
            <span class="n">X_wide_array_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">X_wide_array_norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">standard_scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
            <span class="n">X_deep_array_norm_T</span> <span class="o">=</span> <span class="n">standard_scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_deep_array</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">standard_scaler_deep</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">deep_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
            <span class="n">X_deep_array_norm</span> <span class="o">=</span> <span class="n">standard_scaler_deep</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_deep_array_norm_T</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">X_deep_array_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">X_deep_array_norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">()</span>
            <span class="n">model_classifications</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="n">X_deep_array_norm</span><span class="p">,</span> <span class="n">X_wide_array_norm</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">K</span><span class="o">.</span><span class="n">clear_session</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">coord_pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">enriched_region_coord_list</span><span class="p">):</span>
                <span class="n">out_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">chrom</span><span class="p">,</span> <span class="n">coord_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">model_classifications</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">model_classifications</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">model_classifications</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">X_wide_list</span> <span class="o">=</span> <span class="n">X_wide_array</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">X_wide_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">100.</span> <span class="k">if</span> <span class="n">x</span><span class="o">&gt;</span><span class="mi">10</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X_wide_list</span><span class="p">]</span>
                <span class="n">out_list</span><span class="o">+=</span><span class="n">X_wide_list</span>
                <span class="n">chrom_file_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_list</span><span class="p">)</span>
            <span class="n">bed_file_out</span><span class="o">+=</span><span class="n">chrom_file_out</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_folder</span><span class="o">+</span><span class="n">out_file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">skipheader</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;chrom</span><span class="se">\t</span><span class="s1">start</span><span class="se">\t</span><span class="s1">end</span><span class="se">\t</span><span class="s1">overall_peak_score</span><span class="se">\t</span><span class="s1">shape_score</span><span class="se">\t</span><span class="s1">enrichment_score</span><span class="se">\t</span><span class="s1">pvalue_chrom</span><span class="se">\t</span><span class="s1">pvalue_10kb</span><span class="se">\t</span><span class="s1">pvalue_20kb</span><span class="se">\t</span><span class="s1">pvalue_30kb</span><span class="se">\t</span><span class="s1">pvalue_40kb</span><span class="se">\t</span><span class="s1">pvalue_50kb</span><span class="se">\t</span><span class="s1">pvalue_60kb</span><span class="se">\t</span><span class="s1">pvalue_70kb</span><span class="se">\t</span><span class="s1">pvalue_80kb</span><span class="se">\t</span><span class="s1">pvalue_90kb</span><span class="se">\t</span><span class="s1">pvalue_100kb</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">bed_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">bed_writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">bed_file_out</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>

<h2 id="call-peaks-with-input">Call Peaks with Input</h2>
<p>To call peaks from a bigWig track with an input file, use the <code>callPeaks_Input</code> command.</p>


  <div class="doc doc-object doc-function">

<a id="lanceotron.modules.call_peaks_with_input"></a>
    <div class="doc doc-contents first">

      <p>Call peaks from a coverage track with an input and score them using the LanceOTron model.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>file</code></td>
        <td><code>str</code></td>
        <td><p>Path to bigwig track.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>input</code></td>
        <td><code>str</code></td>
        <td><p>Control input track used to calculate Poisson-based significance of peaks.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>threshold</code></td>
        <td><code>int</code></td>
        <td><p>Initial threshold used for selecting candidate peaks. Defaults to 4.</p></td>
        <td><code>4</code></td>
      </tr>
      <tr>
        <td><code>window</code></td>
        <td><code>int</code></td>
        <td><p>Window size for rolling mean to use for selecting candidate peaks. Defaults to 400.</p></td>
        <td><code>400</code></td>
      </tr>
      <tr>
        <td><code>folder</code></td>
        <td><code>str</code></td>
        <td><p>Output folder. Defaults to "./".</p></td>
        <td><code>&#39;./&#39;</code></td>
      </tr>
      <tr>
        <td><code>skipheader</code></td>
        <td><code>bool</code></td>
        <td><p>Skip writing header. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>lanceotron/modules.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">call_peaks_with_input</span><span class="p">(</span>
        <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
        <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
        <span class="n">window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> 
        <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span> 
        <span class="n">skipheader</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Call peaks from a coverage track with an input and score them using the LanceOTron model.</span>

<span class="sd">    Args:</span>
<span class="sd">        file (str): Path to bigwig track.</span>
<span class="sd">        input (str): Control input track used to calculate Poisson-based significance of peaks.</span>
<span class="sd">        threshold (int, optional): Initial threshold used for selecting candidate peaks. Defaults to 4.</span>
<span class="sd">        window (int, optional): Window size for rolling mean to use for selecting candidate peaks. Defaults to 400.</span>
<span class="sd">        folder (str, optional): Output folder. Defaults to &quot;./&quot;.</span>
<span class="sd">        skipheader (bool, optional): Skip writing header. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">bigwig_file</span> <span class="o">=</span> <span class="n">file</span>
    <span class="n">control_file</span> <span class="o">=</span> <span class="nb">input</span>
    <span class="n">out_folder</span> <span class="o">=</span> <span class="n">make_directory_name</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="n">initial_threshold</span> <span class="o">=</span> <span class="n">threshold</span>

    <span class="n">min_peak_width</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">max_peak_width</span> <span class="o">=</span> <span class="mi">2000</span>
    <span class="n">read_coverage_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">9</span>
    <span class="n">out_file_name</span> <span class="o">=</span> <span class="n">bigwig_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_L-tron.bed&#39;</span>


    <span class="n">pyBigWig_object</span> <span class="o">=</span> <span class="n">pyBigWig</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">bigwig_file</span><span class="p">)</span>
    <span class="n">read_coverage_total</span> <span class="o">=</span> <span class="n">pyBigWig_object</span><span class="o">.</span><span class="n">header</span><span class="p">()[</span><span class="s1">&#39;sumData&#39;</span><span class="p">]</span>
    <span class="n">read_coverage_rphm</span> <span class="o">=</span> <span class="n">read_coverage_total</span><span class="o">/</span><span class="n">read_coverage_factor</span>
    <span class="n">pyBigWig_object</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">bigwig_data</span> <span class="o">=</span> <span class="n">Ltron</span><span class="o">.</span><span class="n">Bigwig_data</span><span class="p">(</span><span class="n">bigwig_file</span><span class="p">)</span>
    <span class="n">genome_stats_dict</span> <span class="o">=</span> <span class="n">bigwig_data</span><span class="o">.</span><span class="n">get_genome_info</span><span class="p">()</span>
    <span class="n">bed_file_out</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">chrom</span> <span class="ow">in</span> <span class="n">genome_stats_dict</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">chrom</span><span class="p">)</span>
        <span class="n">coverage_array_smooth</span> <span class="o">=</span> <span class="n">bigwig_data</span><span class="o">.</span><span class="n">make_chrom_coverage_map</span><span class="p">(</span><span class="n">genome_stats_dict</span><span class="p">[</span><span class="n">chrom</span><span class="p">],</span> <span class="n">smoothing</span><span class="o">=</span><span class="n">window</span><span class="p">)</span>
        <span class="n">enriched_region_coord_list</span> <span class="o">=</span> <span class="n">Ltron</span><span class="o">.</span><span class="n">label_enriched_regions_dynamic_threshold_width</span><span class="p">(</span><span class="n">coverage_array_smooth</span><span class="p">,</span> <span class="n">genome_stats_dict</span><span class="p">[</span><span class="n">chrom</span><span class="p">][</span><span class="s1">&#39;chrom_mean&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">initial_threshold</span><span class="p">,</span> <span class="n">genome_stats_dict</span><span class="p">[</span><span class="n">chrom</span><span class="p">][</span><span class="s1">&#39;chrom_mean&#39;</span><span class="p">],</span> <span class="n">max_peak_width</span><span class="p">,</span> <span class="n">min_region_size</span><span class="o">=</span><span class="n">min_peak_width</span><span class="p">)</span>
        <span class="n">chrom_file_out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">enriched_region_coord_list</span><span class="p">:</span>

            <span class="n">wide_path</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s1">&#39;lanceotron.static&#39;</span><span class="p">,</span> <span class="s1">&#39;standard_scaler_wide_v5_03.p&#39;</span><span class="p">)</span>
            <span class="n">deep_path</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s1">&#39;lanceotron.static&#39;</span><span class="p">,</span> <span class="s1">&#39;standard_scaler_deep_v5_03.p&#39;</span><span class="p">)</span>

            <span class="n">coverage_array</span> <span class="o">=</span> <span class="n">bigwig_data</span><span class="o">.</span><span class="n">make_chrom_coverage_map</span><span class="p">(</span><span class="n">genome_stats_dict</span><span class="p">[</span><span class="n">chrom</span><span class="p">])</span><span class="o">/</span><span class="n">read_coverage_rphm</span>
            <span class="n">X_wide_array</span><span class="p">,</span> <span class="n">X_deep_array</span> <span class="o">=</span> <span class="n">Ltron</span><span class="o">.</span><span class="n">extract_signal_wide_and_deep_chrom</span><span class="p">(</span><span class="n">coverage_array</span><span class="p">,</span> <span class="n">enriched_region_coord_list</span><span class="p">,</span> <span class="n">read_coverage_rphm</span><span class="p">)</span>
            <span class="n">standard_scaler_wide</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">wide_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
            <span class="n">X_wide_array_norm</span> <span class="o">=</span> <span class="n">standard_scaler_wide</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_wide_array</span><span class="p">)</span>
            <span class="n">X_wide_array_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">X_wide_array_norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">standard_scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
            <span class="n">X_deep_array_norm_T</span> <span class="o">=</span> <span class="n">standard_scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_deep_array</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">standard_scaler_deep</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">deep_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
            <span class="n">X_deep_array_norm</span> <span class="o">=</span> <span class="n">standard_scaler_deep</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_deep_array_norm_T</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">X_deep_array_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">X_deep_array_norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">()</span>
            <span class="n">model_classifications</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="n">X_deep_array_norm</span><span class="p">,</span> <span class="n">X_wide_array_norm</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">pyBigWig_input</span> <span class="o">=</span> <span class="n">pyBigWig</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">control_file</span><span class="p">)</span>
            <span class="n">read_coverage_total_input</span> <span class="o">=</span> <span class="n">pyBigWig_input</span><span class="o">.</span><span class="n">header</span><span class="p">()[</span><span class="s1">&#39;sumData&#39;</span><span class="p">]</span>
            <span class="n">read_coverage_rphm_input</span> <span class="o">=</span> <span class="n">read_coverage_total_input</span><span class="o">/</span><span class="n">read_coverage_factor</span>
            <span class="n">K</span><span class="o">.</span><span class="n">clear_session</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">coord_pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">enriched_region_coord_list</span><span class="p">):</span>
                <span class="n">average_cov</span> <span class="o">=</span> <span class="n">coverage_array</span><span class="p">[</span><span class="n">coord_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">coord_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">*</span><span class="n">read_coverage_rphm</span>
                <span class="n">pvalue_input</span> <span class="o">=</span> <span class="n">calculate_pvalue_from_input</span><span class="p">(</span><span class="n">chrom</span><span class="p">,</span> <span class="n">coord_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">read_coverage_total</span><span class="p">,</span> <span class="n">read_coverage_total_input</span><span class="p">,</span> <span class="n">pyBigWig_input</span><span class="p">,</span> <span class="n">average_cov</span><span class="p">)</span>
                <span class="n">out_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">chrom</span><span class="p">,</span> <span class="n">coord_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">model_classifications</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">model_classifications</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">model_classifications</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pvalue_input</span><span class="p">]</span>
                <span class="n">X_wide_list</span> <span class="o">=</span> <span class="n">X_wide_array</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">X_wide_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">100.</span> <span class="k">if</span> <span class="n">x</span><span class="o">&gt;</span><span class="mi">10</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X_wide_list</span><span class="p">]</span>
                <span class="n">out_list</span><span class="o">+=</span><span class="n">X_wide_list</span>
                <span class="n">chrom_file_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_list</span><span class="p">)</span>
            <span class="n">pyBigWig_input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">bed_file_out</span><span class="o">+=</span><span class="n">chrom_file_out</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_folder</span><span class="o">+</span><span class="n">out_file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">skipheader</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;chrom</span><span class="se">\t</span><span class="s1">start</span><span class="se">\t</span><span class="s1">end</span><span class="se">\t</span><span class="s1">overall_peak_score</span><span class="se">\t</span><span class="s1">shape_score</span><span class="se">\t</span><span class="s1">enrichment_score</span><span class="se">\t</span><span class="s1">pvalue_input</span><span class="se">\t</span><span class="s1">pvalue_chrom</span><span class="se">\t</span><span class="s1">pvalue_10kb</span><span class="se">\t</span><span class="s1">pvalue_20kb</span><span class="se">\t</span><span class="s1">pvalue_30kb</span><span class="se">\t</span><span class="s1">pvalue_40kb</span><span class="se">\t</span><span class="s1">pvalue_50kb</span><span class="se">\t</span><span class="s1">pvalue_60kb</span><span class="se">\t</span><span class="s1">pvalue_70kb</span><span class="se">\t</span><span class="s1">pvalue_80kb</span><span class="se">\t</span><span class="s1">pvalue_90kb</span><span class="se">\t</span><span class="s1">pvalue_100kb</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">bed_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">bed_writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">bed_file_out</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>

<h2 id="score-a-bed-file">Score a Bed file</h2>
<p>To score the peaks in an existing Bed file, use the <code>scoreBed</code> command.</p>


  <div class="doc doc-object doc-function">

<a id="lanceotron.modules.score_bed"></a>
    <div class="doc doc-contents first">

      <p>Score an existing bed file using LanceOTron's model and a coverage track.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>file</code></td>
        <td><code>str</code></td>
        <td><p>Input bigWig track.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>bed</code></td>
        <td><code>str</code></td>
        <td><p>Bed file of regions to score.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>folder</code></td>
        <td><code>str</code></td>
        <td><p>Output folder. Defaults to "./".</p></td>
        <td><code>&#39;./&#39;</code></td>
      </tr>
      <tr>
        <td><code>skipheader</code></td>
        <td><code>bool</code></td>
        <td><p>Skip writing header. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>lanceotron/modules.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">score_bed</span><span class="p">(</span>
    <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">bed</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span>
    <span class="n">skipheader</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Score an existing bed file using LanceOTron&#39;s model and a coverage track.</span>

<span class="sd">    Args:</span>
<span class="sd">        file (str): Input bigWig track.</span>
<span class="sd">        bed (str): Bed file of regions to score.</span>
<span class="sd">        folder (str): Output folder. Defaults to &quot;./&quot;.</span>
<span class="sd">        skipheader (bool): Skip writing header. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bigwig_file</span> <span class="o">=</span> <span class="n">file</span>
    <span class="n">out_folder</span> <span class="o">=</span> <span class="n">make_directory_name</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="n">bed_file</span> <span class="o">=</span> <span class="n">bed</span>

    <span class="n">read_coverage_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">9</span>
    <span class="n">out_file_name</span> <span class="o">=</span> <span class="n">bigwig_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_L-tron.bed&#39;</span>

    <span class="n">pyBigWig_object</span> <span class="o">=</span> <span class="n">pyBigWig</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">bigwig_file</span><span class="p">)</span>
    <span class="n">read_coverage_total</span> <span class="o">=</span> <span class="n">pyBigWig_object</span><span class="o">.</span><span class="n">header</span><span class="p">()[</span><span class="s1">&#39;sumData&#39;</span><span class="p">]</span>
    <span class="n">read_coverage_rphm</span> <span class="o">=</span> <span class="n">read_coverage_total</span><span class="o">/</span><span class="n">read_coverage_factor</span>
    <span class="n">pyBigWig_object</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">bed_list</span> <span class="o">=</span> <span class="n">Ltron</span><span class="o">.</span><span class="n">bed_file_to_list</span><span class="p">(</span><span class="n">bed_file</span><span class="p">)</span>
    <span class="n">chroms_in_bed</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">bed_entry</span> <span class="ow">in</span> <span class="n">bed_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bed_entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chroms_in_bed</span><span class="p">:</span>
            <span class="n">chroms_in_bed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bed_entry</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">bigwig_data</span> <span class="o">=</span> <span class="n">Ltron</span><span class="o">.</span><span class="n">Bigwig_data</span><span class="p">(</span><span class="n">bigwig_file</span><span class="p">)</span>
    <span class="n">genome_stats_dict</span> <span class="o">=</span> <span class="n">bigwig_data</span><span class="o">.</span><span class="n">get_genome_info</span><span class="p">(</span><span class="n">include_special_chromosomes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">bed_file_out</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">chrom</span> <span class="ow">in</span> <span class="n">chroms_in_bed</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">chrom</span><span class="p">)</span>
        <span class="n">enriched_region_coord_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">bed_entry</span> <span class="ow">in</span> <span class="n">bed_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bed_entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">chrom</span><span class="p">:</span>
                <span class="n">enriched_region_coord_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">bed_entry</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bed_entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">chrom_file_out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">enriched_region_coord_list</span><span class="p">:</span>
            <span class="n">wide_path</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s1">&#39;lanceotron.static&#39;</span><span class="p">,</span> <span class="s1">&#39;standard_scaler_wide_v5_03.p&#39;</span><span class="p">)</span>
            <span class="n">deep_path</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s1">&#39;lanceotron.static&#39;</span><span class="p">,</span> <span class="s1">&#39;standard_scaler_deep_v5_03.p&#39;</span><span class="p">)</span>

            <span class="n">coverage_array</span> <span class="o">=</span> <span class="n">bigwig_data</span><span class="o">.</span><span class="n">make_chrom_coverage_map</span><span class="p">(</span><span class="n">genome_stats_dict</span><span class="p">[</span><span class="n">chrom</span><span class="p">])</span><span class="o">/</span><span class="n">read_coverage_rphm</span>
            <span class="n">X_wide_array</span><span class="p">,</span> <span class="n">X_deep_array</span> <span class="o">=</span> <span class="n">Ltron</span><span class="o">.</span><span class="n">extract_signal_wide_and_deep_chrom</span><span class="p">(</span><span class="n">coverage_array</span><span class="p">,</span> <span class="n">enriched_region_coord_list</span><span class="p">,</span> <span class="n">read_coverage_rphm</span><span class="p">)</span>
            <span class="n">standard_scaler_wide</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">wide_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
            <span class="n">X_wide_array_norm</span> <span class="o">=</span> <span class="n">standard_scaler_wide</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_wide_array</span><span class="p">)</span>
            <span class="n">X_wide_array_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">X_wide_array_norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">standard_scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
            <span class="n">X_deep_array_norm_T</span> <span class="o">=</span> <span class="n">standard_scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_deep_array</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">standard_scaler_deep</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">deep_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
            <span class="n">X_deep_array_norm</span> <span class="o">=</span> <span class="n">standard_scaler_deep</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_deep_array_norm_T</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">X_deep_array_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">X_deep_array_norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">()</span>
            <span class="n">model_classifications</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="n">X_deep_array_norm</span><span class="p">,</span> <span class="n">X_wide_array_norm</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">K</span><span class="o">.</span><span class="n">clear_session</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">coord_pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">enriched_region_coord_list</span><span class="p">):</span>
                <span class="n">out_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">chrom</span><span class="p">,</span> <span class="n">coord_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">model_classifications</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">model_classifications</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">model_classifications</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">X_wide_list</span> <span class="o">=</span> <span class="n">X_wide_array</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">X_wide_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">100.</span> <span class="k">if</span> <span class="n">x</span><span class="o">&gt;</span><span class="mi">10</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X_wide_list</span><span class="p">]</span>
                <span class="n">out_list</span><span class="o">+=</span><span class="n">X_wide_list</span>
                <span class="n">chrom_file_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_list</span><span class="p">)</span>
            <span class="n">bed_file_out</span><span class="o">+=</span><span class="n">chrom_file_out</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_folder</span><span class="o">+</span><span class="n">out_file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">skipheader</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;chrom</span><span class="se">\t</span><span class="s1">start</span><span class="se">\t</span><span class="s1">end</span><span class="se">\t</span><span class="s1">overall_peak_score</span><span class="se">\t</span><span class="s1">shape_score</span><span class="se">\t</span><span class="s1">enrichment_score</span><span class="se">\t</span><span class="s1">pvalue_chrom</span><span class="se">\t</span><span class="s1">pvalue_10kb</span><span class="se">\t</span><span class="s1">pvalue_20kb</span><span class="se">\t</span><span class="s1">pvalue_30kb</span><span class="se">\t</span><span class="s1">pvalue_40kb</span><span class="se">\t</span><span class="s1">pvalue_50kb</span><span class="se">\t</span><span class="s1">pvalue_60kb</span><span class="se">\t</span><span class="s1">pvalue_70kb</span><span class="se">\t</span><span class="s1">pvalue_80kb</span><span class="se">\t</span><span class="s1">pvalue_90kb</span><span class="se">\t</span><span class="s1">pvalue_100kb</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">bed_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">bed_writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">bed_file_out</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>

<h2 id="examples">Examples</h2>
<p>There is a basic bigWig file included in the <code>test</code> subdirectory. To try out the caller, execute it on this file. </p>
<pre><code class="language-sh">lanceotron callPeaks test/chr22.bw -f output_folder
</code></pre>
<h2 id="citation">Citation</h2>
<pre><code>@article {Hentges2021.01.25.428108,
    author = {Hentges, Lance D. and Sergeant, Martin J. and Downes, Damien J. and Hughes, Jim R. and Taylor, Stephen},
    title = {LanceOtron: a deep learning peak caller for ATAC-seq, ChIP-seq, and DNase-seq},
    year = {2021},
    doi = {10.1101/2021.01.25.428108},
    publisher = {Cold Spring Harbor Laboratory},
    URL = {https://www.biorxiv.org/content/early/2021/01/27/2021.01.25.428108},
    journal = {bioRxiv}
}
</code></pre>
<h2 id="bug-reports-and-improvement-suggestions">Bug Reports and Improvement Suggestions</h2>
<p>Please <a href="https://github.com/Chris1221/lanceotron/issues/new/choose">raise an issue</a> if there is anything you wish to ask or contribute. </p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
      
        
        <a href="genome_tutorial/" class="md-footer__link md-footer__link--next" aria-label="Next: Basic Peak Calling" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Basic Peak Calling
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.29db7785.min.js"></script>
      
    
  </body>
</html>